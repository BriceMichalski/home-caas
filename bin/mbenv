#!/bin/bash

if [ "$#" -lt 1 ]; then
    echo "Erreur : first arugement need to be user used to connect to mbcaas"
    exit 1  # Quitter le script avec un code d'erreur
fi


#FIND SOPS FILE TO MOUNT
SOPS_MOUNT_TARGET="/home/mbcaas-tools/sops/age/keys.txt"
SOPS_MOUNT=" -v \"$MBCAAS_SOPS_FILE:$SOPS_MOUNT_TARGET\""
if [[ -f $HOME/Library/Application\ Support/sops/age/keys.txt && -z $MBCAAS_SOPS_FILE ]]; then
    SOPS_MOUNT=" -v \"$HOME/Library/Application Support/sops/age/keys.txt:$SOPS_MOUNT_TARGET\""
fi

docker_cmd="docker run --rm -it -e "TERM=xterm-256color" -e "MBCAAS_USER=$1" $SOPS_MOUNT:ro -v ${PWD}:/workdir ghcr.io/bricemichalski/mbcaas/mbcaas-toolkit:latest $1"

eval $docker_cmd
