---
{{ $envs := list "dev" "prod" }}
environments:
  {{- range $envs }}
  {{ . }}:
    values:
      - envs/commons.yml
      - envs/{{ . }}/env.yml
      - envs/{{ . }}/quotas.yml
    secrets:
      - envs/secrets.sops.yaml
      - envs/{{ . }}/secrets.sops.yaml
  {{- end }}

---

helmDefaults:
  timeout: 600
  force: false
  createNamespace: false

templates:
  default: &default
    missingFileHandler: Warn
    installedTemplate:  "{{`{{ .Values.releases.installed | get .Release.Name }}`}}"
    version: "{{`{{ .Values.releases.version | get .Release.Name }}`}}"
    values:
      - modules/{{`{{ .Release.Name }}`}}.gotmpl

repositories:
  - name: traefik
    url: https://helm.traefik.io/traefik

  - name: k8s-at-home
    url: https://k8s-at-home.com/charts

  - name: grafana
    url: https://grafana.github.io/helm-charts

  - name: prometheus-community
    url: https://prometheus-community.github.io/helm-charts

  - name: bitnami
    url: https://charts.bitnami.com/bitnami

  - name: strimzi
    url: https://strimzi.io/charts/

  - name: akhq
    url: https://akhq.io/

  - name: democratic-csi
    url: https://democratic-csi.github.io/charts/

  - name: teleport
    url: https://charts.releases.teleport.dev

  - name: jetstack
    url: https://charts.jetstack.io

  - name: sonatype
    url: https://sonatype.github.io/helm3-charts/

releases:
  # Storage
  - name: storage-snapshot-controller
    namespace: kube-storage
    chart: democratic-csi/snapshot-controller
    version: 0.2.4

  - name: storage-hdd-block
    namespace: kube-storage
    chart: democratic-csi/democratic-csi
    disableValidation: true
    <<: *default

  - name: storage-hdd-file
    namespace: kube-storage
    chart: democratic-csi/democratic-csi
    disableValidation: true
    <<: *default

  - name: storage-ssd-block
    namespace: kube-storage
    chart: democratic-csi/democratic-csi
    disableValidation: true
    <<: *default

  - name: storage-ssd-file
    namespace: kube-storage
    chart: democratic-csi/democratic-csi
    disableValidation: true
    <<: *default

  # Network
  - name: e-dns-cloudflare
    namespace: kube-network
    chart: bitnami/external-dns
    <<: *default

  - name: traefik
    namespace: kube-network
    chart: traefik/traefik
    <<: *default

  - name: error-pages
    namespace: kube-network
    chart: k8s-at-home/error-pages
    <<: *default

  - name: cert-manager
    namespace: kube-network
    chart: jetstack/cert-manager
    <<: *default

  - name: network-config
    namespace: kube-network
    chart: ./charts/network-config
    <<: *default

  # Observability
  - name: loki-stack
    namespace: kube-monitor
    chart: grafana/loki-stack
    <<: *default

  - name: prometheus-stack
    namespace: kube-monitor
    chart: prometheus-community/kube-prometheus-stack
    <<: *default

  - name: monitor-config
    namespace: kube-monitor
    chart: ./charts/monitor-config
    <<: *default

  # Access
  - name: teleport
    namespace: kube-access
    chart: teleport/teleport-cluster
    <<: *default

  # Extra OpÃ©rator
  - name: strimzi
    namespace: extra-operator
    chart: strimzi/strimzi-kafka-operator
    <<: *default

  # Tools
  - name: nexus-pg
    namespace: mbcaas-tools
    chart: bitnami/postgresql
    <<: *default

  - name: nexus
    namespace: mbcaas-tools
    chart: sonatype/nxrm-ha
    <<: *default
